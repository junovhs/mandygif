export component RegionSelector inherits Window {
    width: 3840px;  // Large enough for 4K
    height: 2160px;
    always-on-top: true;
    no-frame: true;
    
    in-out property <length> sel-x: 0px;
    in-out property <length> sel-y: 0px;
    in-out property <length> sel-width: 3840px;
    in-out property <length> sel-height: 2160px;
    
    callback confirm();
    callback cancel();
    
    background: transparent;
    
    // Selection box
    Rectangle {
        x: sel-x;
        y: sel-y;
        width: sel-width;
        height: sel-height;
        
        // Colored semi-transparent overlay inside frame
        Rectangle {
            width: parent.width;
            height: parent.height;
            background: #00ffff20;
            border-width: 2px;
            border-color: #00ffff;
        }
        
        // Top bar
        Rectangle {
            y: -40px;
            width: parent.width;
            height: 40px;
            background: #1a1a1a;
            
            HorizontalLayout {
                padding: 8px;
                spacing: 8px;
                
                Text {
                    text: round(sel-width / 1px) + " × " + round(sel-height / 1px);
                    color: white;
                    font-size: 14px;
                    vertical-alignment: center;
                    horizontal-stretch: 1;
                }
                
                Rectangle {
                    width: 24px;
                    height: 24px;
                    background: #cc0000;
                    border-radius: 4px;
                    Text {
                        text: "✕";
                        color: white;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                    TouchArea { clicked => { root.cancel(); } }
                }
            }
            
            // Drag to move entire window
            TouchArea {
                x: 0;
                y: 0;
                width: parent.width - 40px;
                height: parent.height;
                
                property <length> offset-x;
                property <length> offset-y;
                
                pointer-event(event) => {
                    if (event.button == PointerEventButton.left && event.kind == PointerEventKind.down) {
                        self.offset-x = self.mouse-x;
                        self.offset-y = self.mouse-y;
                    }
                }
                
                moved => {
                    if (self.pressed) {
                        sel-x += self.mouse-x - self.offset-x;
                        sel-y += self.mouse-y - self.offset-y;
                    }
                }
            }
        }
        
        // Bottom bar
        Rectangle {
            y: parent.height;
            width: parent.width;
            height: 50px;
            background: #1a1a1a;
            
            HorizontalLayout {
                padding: 10px;
                spacing: 10px;
                alignment: center;
                
                // Record button
                Rectangle {
                    width: 60px;
                    height: 30px;
                    background: #ff0000;
                    border-radius: 15px;
                    
                    Text {
                        text: "REC";
                        color: white;
                        font-weight: 700;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                    
                    TouchArea {
                        clicked => { root.confirm(); }
                    }
                }
            }
        }
        
        // Bottom-right resize handle on the bottom bar
        Rectangle {
            x: parent.width - 25px;
            y: parent.height + 10px;
            width: 20px;
            height: 30px;
            
            // Line 1
            Rectangle { x: 15px; y: 5px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 14px; y: 6px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 13px; y: 7px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 12px; y: 8px; width: 2px; height: 2px; background: #888; }
            
            // Line 2
            Rectangle { x: 11px; y: 11px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 10px; y: 12px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 9px; y: 13px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 8px; y: 14px; width: 2px; height: 2px; background: #888; }
            
            // Line 3
            Rectangle { x: 7px; y: 17px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 6px; y: 18px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 5px; y: 19px; width: 2px; height: 2px; background: #888; }
            Rectangle { x: 4px; y: 20px; width: 2px; height: 2px; background: #888; }
            
            TouchArea {
                width: parent.width;
                height: parent.height;
                
                moved => {
                    if (self.pressed) {
                        sel-width = max(200px, sel-width + self.mouse-x);
                        sel-height = max(100px, sel-height + self.mouse-y);
                    }
                }
            }
        }
    }
}